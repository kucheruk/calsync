# –°–≤–æ–¥–∫–∞ –ø–æ —Ç–µ—Å—Ç–∞–º CalSync

## –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 17 –¥–µ–∫–∞–±—Ä—è 2024  
**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 53  
**–£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:** 47  
**–ù–µ—É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:** 6  
**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:** ~75%

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### FR-001: –ó–∞–≥—Ä—É–∑–∫–∞ .ics —Ñ–∞–π–ª–æ–≤ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- **–§–∞–π–ª:** `FR001_IcsDownloaderTests.cs`
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 18
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - HTTP/HTTPS –∑–∞–≥—Ä—É–∑–∫–∞
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Basic, Digest)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
  - Timeout –∏ retry –º–µ—Ö–∞–Ω–∏–∑–º—ã
  - SSL –≤–∞–ª–∏–¥–∞—Ü–∏—è
  - Webcal –ø—Ä–æ—Ç–æ–∫–æ–ª
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º iCloud –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º

### FR-002: –ü–∞—Ä—Å–∏–Ω–≥ .ics —Ñ–∞–π–ª–æ–≤ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
- **–§–∞–π–ª:** `FR002_IcsParserTests.cs`
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 24
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - RFC 5545 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
  - VEVENT –ø–∞—Ä—Å–∏–Ω–≥
  - –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–±—ã—Ç–∏—è (RRULE)
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
  - –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
  - –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  - –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —Å–æ–±—ã—Ç–∏–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### FR-003: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Exchange Server üîÑ –í –†–ê–ó–†–ê–ë–û–¢–ö–ï
- **–§–∞–π–ª:** `FR003_ExchangeServiceTests.cs`
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 11
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è 5 –ø—Ä–æ—Ö–æ–¥—è—Ç, 6 —Å –æ—à–∏–±–∫–∞–º–∏
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Exchange
  - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  - ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
  - ‚ö†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (–ø—Ä–æ–±–ª–µ–º–∞ —Å timezone)
  - ‚ö†Ô∏è –ú–∞–ø–ø–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
  - ‚úÖ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

## –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### MockEwsServer üÜï
- **–§–∞–π–ª:** `MockEwsServer.cs`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–º–∏—Ç–∞—Ü–∏—è Exchange Web Services
- **–§—É–Ω–∫—Ü–∏–∏:**
  - HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost
  - SOAP –æ–±—Ä–∞–±–æ—Ç–∫–∞
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GetFolder, FindItem, GetItem, CreateItem, DeleteItem
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### EwsRequestRecorder üÜï
- **–§–∞–π–ª:** `EwsRequestRecorder.cs`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–ø–∏—Å—å –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ EWS –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –≤ JSON
  - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø–∏—Å–µ–π
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ XML
  - –ê–Ω–∞–ª–∏–∑ SOAP —Å–æ–æ–±—â–µ–Ω–∏–π

### ExchangeIntegrationTests üÜï
- **–§–∞–π–ª:** `ExchangeIntegrationTests.cs`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Exchange
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ –µ—Å–ª–∏ Exchange –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
  - Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - Cleanup —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ EWS –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–í–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª–∏ –∑–∞–ø–∏—Å–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–∞–ª—å–Ω—ã–µ EWS –∑–∞–ø—Ä–æ—Å—ã:

### 1. GetFolder - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
```xml
<m:GetFolder>
  <m:FolderShape>
    <t:BaseShape>AllProperties</t:BaseShape>
  </m:FolderShape>
  <m:FolderIds>
    <t:DistinguishedFolderId Id="calendar" />
  </m:FolderIds>
</m:GetFolder>
```

### 2. FindItem - –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π
```xml
<m:FindItem Traversal="Shallow">
  <m:ItemShape>
    <t:BaseShape>AllProperties</t:BaseShape>
  </m:ItemShape>
  <m:CalendarView StartDate="2025-06-09T21:00:00.000Z" EndDate="2025-07-16T21:00:00.000Z" />
  <m:ParentFolderIds>
    <t:FolderId Id="[CALENDAR_ID]" ChangeKey="[CHANGE_KEY]" />
  </m:ParentFolderIds>
</m:FindItem>
```

### 3. GetItem - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —Å–æ–±—ã—Ç–∏—è
```xml
<m:GetItem>
  <m:ItemShape>
    <t:BaseShape>AllProperties</t:BaseShape>
  </m:ItemShape>
  <m:ItemIds>
    <t:ItemId Id="[ITEM_ID]" ChangeKey="[CHANGE_KEY]" />
  </m:ItemIds>
</m:GetItem>
```

### 4. DeleteItem - –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
```xml
<m:DeleteItem DeleteType="MoveToDeletedItems" SendMeetingCancellations="SendToAllAndSaveCopy">
  <m:ItemIds>
    <t:ItemId Id="[ITEM_ID]" ChangeKey="[CHANGE_KEY]" />
  </m:ItemIds>
</m:DeleteItem>
```

## –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Timezone Issues
- EWS API –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å timezone –≤ .NET 9
- –û—à–∏–±–∫–∞: "An item with the same key has already been added. Key: Dlt/1880"
- –í–ª–∏—è–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

### 2. DateTime Mapping
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É UTC –∏ Local –≤—Ä–µ–º–µ–Ω–µ–º
- –ù—É–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ ExchangeService

### 3. Mock Server Stability
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ "Cannot access a disposed object"
- –ù—É–∂–Ω–∞ —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ lifecycle

## –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
2. **–ú–æ–∫-—Å–µ—Ä–≤–µ—Ä EWS** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ó–∞–ø–∏—Å—å —Ä–µ–∞–ª—å–Ω—ã—Ö EWS –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π** –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** —Å —Ä–µ–∞–ª—å–Ω—ã–º Exchange —Å–µ—Ä–≤–µ—Ä–æ–º
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ:
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ timezone –ø—Ä–æ–±–ª–µ–º –≤ EWS
2. –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∫-—Å–µ—Ä–≤–µ—Ä–∞
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CreateItem –æ–ø–µ—Ä–∞—Ü–∏–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å timezone –ø—Ä–æ–±–ª–µ–º—ã** –≤ ExchangeService
2. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É UpdateItem** –≤ –º–æ–∫-—Å–µ—Ä–≤–µ—Ä–µ
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FR-004** (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π)
4. **–°–æ–∑–¥–∞—Ç—å end-to-end —Ç–µ—Å—Ç—ã** ICS ‚Üî Exchange
5. **–î–æ–±–∞–≤–∏—Ç—å performance benchmarks**

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
dotnet test

# –¢–æ–ª—å–∫–æ FR001 (ICS Downloader)
dotnet test --filter "FullyQualifiedName~FR001"

# –¢–æ–ª—å–∫–æ FR002 (ICS Parser)  
dotnet test --filter "FullyQualifiedName~FR002"

# –¢–æ–ª—å–∫–æ FR003 (Exchange Service)
dotnet test --filter "FullyQualifiedName~FR003"

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Exchange
dotnet test --filter "FullyQualifiedName~ExchangeIntegration"

# –¢–µ—Å—Ç—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
dotnet test --filter "FullyQualifiedName~TestHelpers"
```

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ –º–æ—â–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è EWS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–ø–∏—Å–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—á—Ç–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ) —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ —É–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω. 